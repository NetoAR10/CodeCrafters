<%- include('includes/sidebar.ejs') %>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title><%= pageTitle %></title>
  <link rel="stylesheet" href="/css/stylesb.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    .main-content {
      margin-left: 240px; 
      padding: 20px;
    }
    .main-content h1 {
      text-align: center;
      color: #333;
    }
    .main-content table {
      width: 100%; 
      border-collapse: collapse;
    }
    .main-content th, .main-content td {
      padding: 10px;
      border: 1px solid #ddd; 
      text-align: left;
    }
    .main-content th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    .main-content td {
      background-color: #ffffff; 
    }
  </style>
</head>
<body>
  <% include('includes/sidebar.ejs') %> 
  <div class="main-content">
    <h1>Historial de Pagos</h1>
    <table>
      <thead>
        <tr>
          <th>Pago</th>
          <th>%</th>
          <th>Referencia</th>
          <th>Nombre</th>
          <th>Fecha</th>
          <th>Monto</th>
          <th>MÃ©todo</th>
          <th>Banco</th>
          <th>Nota</th>
        </tr>
      </thead>
      <tbody>
        <% payments.forEach(payment => { %>
          <tr>
            <td><%= payment.IDPago !== null && payment.IDPago !== undefined ? payment.IDPago : 'N/A' %></td>
            <td><%= payment.Porcentaje !== undefined ? (payment.Porcentaje * 100).toFixed(2) + '%' : 'N/A' %></td>
            <td><%= payment.Referencia || 'N/A' %></td>
            <td><%= payment.Nombre || 'N/A' %></td>
            <td><%= payment.Fecha_de_pago ? new Date(payment.Fecha_de_pago).toLocaleDateString('es-MX', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A' %></td>
            <td>$<%= payment.Cant_pagada !== null && payment.Cant_pagada !== undefined ? payment.Cant_pagada.toFixed(2) : '0.00' %></td>
            <td><%= payment.Metodo || 'N/A' %></td>
            <td><%= payment.Banco || 'N/A' %></td>
            <td><%= payment.Nota || 'Ninguna' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
    <form action="/pagos/descargar-csv" method="GET">
      <button type="submit">Descargar como CSV</button>
    </form>
  </div>
</body>
</html>
